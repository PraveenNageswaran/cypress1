import com.fasterxml.jackson.databind.*
import groovy.json.JsonOutput

// ‚úÖ Fetch the current unique ID from ForEach Controller
def uniqueId = vars.get("k5_id")
log.info("üîπ Processing Unique ID: " + uniqueId)

// ‚úÖ Load filtered K4 JSON
def k4File = new File("C:/workspace/k4_filtered.json")
def objectMapper = new ObjectMapper()
def k4Records = objectMapper.readTree(k4File)

// ‚úÖ Find matching K4 record
def matchedRecord = k4Records.find { it.get("unique_id").asText() == uniqueId }

if (matchedRecord) {
    vars.put("k4_record", JsonOutput.toJson(matchedRecord))
    log.info("‚úÖ Found matching K4 record for ID: " + uniqueId)
} else {
    log.warn("‚ùå No matching record found in K4 for ID: " + uniqueId)
}
