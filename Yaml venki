import org.yaml.snakeyaml.Yaml
import org.apache.commons.io.FileUtils

// Load YAML file
def yamlFile = new File('C:/Workspace/pp.yaml')
def yamlData = FileUtils.readFileToString(yamlFile, "UTF-8")

// Parse YAML
def yaml = new Yaml()
def yamlObject = yaml.load(yamlData)

// Initialize CSV content
def csvContent = ""

// Generate CSV headers dynamically
def headers = yamlObject.collect { key, value ->
    if (value instanceof Map) {
        value.keySet()
    } else {
        []
    }
}.flatten().unique().join(",")

csvContent += headers + "\n"

// Generate CSV rows
yamlObject.each { key, value ->
    def rowValues = headers.split(",").collect { value[it] ?: "" }
    csvContent += rowValues.join(",") + "\n"
}

// Write CSV content to file
def outputFile = new File('C:/Workspace/output.csv')
FileUtils.writeStringToFile(outputFile, csvContent, "UTF-8")

log.info("CSV file saved at: ${outputFile.absolutePath}")
