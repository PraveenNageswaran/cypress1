def tableAResultSet = vars.getObject("tableAResultSet")
def tableBResultSet = vars.getObject("tableBResultSet")

def columnCountA = tableAResultSet.getMetaData().getColumnCount()
def columnCountB = tableBResultSet.getMetaData().getColumnCount()

def columnsA = (1..columnCountA).collect { tableAResultSet.getMetaData().getColumnName(it) }
def columnsB = (1..columnCountB).collect { tableBResultSet.getMetaData().getColumnName(it) }

while (tableAResultSet.next() && tableBResultSet.next()) {
    def match = true

    for (int i = 1; i <= columnCountA; i++) {
        def valueA = tableAResultSet.getString(i)
        def valueB = tableBResultSet.getString(i)

        if (!valueA.equals(valueB)) {
            match = false
            log.info("Unmatched: Column ${columnsA[i-1]} - Table A: $valueA, Table B: $valueB")
            break
        }
    }

    if (match) {
        log.info("Matched: Row")
    }
}

// Check if any additional rows exist in either table
while (tableAResultSet.next()) {
    log.info("Unmatched: Additional row in Table A - " + tableAResultSet.getString(1))
}

while (tableBResultSet.next()) {
    log.info("Unmatched: Additional row in Table B - " + tableBResultSet.getString(1))
}
